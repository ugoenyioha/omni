# TCP/TLS Passthrough configuration for siderolink
# This goes in the main nginx context, not in http block

stream {
    # Siderolink TCP passthrough on port 8090
    upstream siderolink_backend {
        server omni:8090;
    }
    
    server {
        listen 192.168.1.8:8090;  # Listen only on the macvlan IP
        proxy_pass siderolink_backend;
        proxy_timeout 600s;
        proxy_connect_timeout 60s;
        
        # TCP nodelay for better performance
        tcp_nodelay on;
    }
    
    # Siderolink Wireguard passthrough on port 50180
    upstream wireguard_backend {
        server omni:50180;
    }
    
    server {
        listen 192.168.1.8:50180 udp;  # Listen only on the macvlan IP
        proxy_pass wireguard_backend;
        proxy_timeout 300s;
        
        # UDP specific settings
        proxy_responses 0;  # Expect no responses for UDP
    }
}